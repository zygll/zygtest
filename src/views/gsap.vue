<template>
  <div id="app">
    <svg id="motionPath" viewBox="-20 0 557 190">
      <path
        id="path"
        fill="none"
        d="M8,102 C15,83 58,25 131,24 206,24 233,63 259,91 292,125 328,155 377,155 464,155 497,97 504,74"
      />
      <g class="astronaut">
        <path
          fill="#CCC"
          d="M25 127.7h.5v-16.1H4.1c.9 3.7 2.8 6.9 5.6 9.8 4.3 4.2 9.4 6.3 15.3 6.3m69.9 0h.1c5.9 0 11-2.1 15.2-6.3 2.9-2.9 4.7-6.1 5.6-9.8H94.4v16.1h.5M31.8 31.4c-4.3.9-8.1 2.9-11.4 6.2-4.5 4.5-6.7 9.9-6.7 16.2v13.6c3.3-2.1 7.1-3.2 11.3-3.2.9 0 1.7 0 2.6.1-1.5-3.9-2.3-8.2-2.3-12.7 0-7.6 2.2-14.3 6.5-20.2m74.5 36V53.8c0-6.3-2.2-11.7-6.7-16.2-3-3-6.5-5.1-10.4-6l-.2.8c3.9 5.6 5.8 12 5.8 19.2 0 4.2-.7 8.1-2 11.8l.1.8c.7-.1 1.4-.1 2.2-.1 4.1.1 7.8 1.2 11.2 3.3z"
        />
        <path
          fill="#FFF"
          d="M59.9 17.1h-.1c-9.5 0-17.6 3.4-24.3 10.1-1.3 1.3-2.5 2.7-3.6 4.2-4.3 5.9-6.5 12.6-6.5 20.3 0 4.6.8 8.8 2.3 12.7.2.6.5 1.2.8 1.8 1.7 3.6 4 6.9 7.1 9.9 3.3 3.3 6.8 5.7 10.7 7.4.1 0 .2.1.2.1.8.3 1.6.7 2.5.9 3.4 1.1 7.1 1.7 11 1.7 9.5 0 17.7-3.4 24.4-10.1 3.6-3.6 6.2-7.5 7.9-11.8l.3-.9c1.3-3.6 1.9-7.6 1.9-11.7 0-7.2-1.9-13.5-5.7-19.1l-.2-.2s0-.1-.1-.1l-.1-.1-.1-.1-.1-.1c0-.1-.1-.1-.1-.2 0 0 0-.1-.1-.1-1.1-1.5-2.3-2.9-3.7-4.3-6.8-6.9-14.9-10.3-24.4-10.3m50.2 53.4c-1.2-1.2-2.5-2.3-3.9-3.1-3.3-2.1-7.1-3.2-11.3-3.2-.7 0-1.5 0-2.2.1h-.4l-.3-.1c-1.7 4.3-4.3 8.3-7.9 11.8-6.7 6.7-14.9 10.1-24.4 10.1-3.9 0-7.6-.6-11-1.7-.8-.3-1.7-.6-2.5-.9-.1 0-.2-.1-.2-.1-3.9-1.7-7.5-4.2-10.7-7.4-3-3-5.4-6.3-7.1-9.9-.3-.6-.5-1.2-.8-1.8-.8-.1-1.7-.1-2.6-.1-4.2 0-8 1.1-11.3 3.2-1.4.9-2.7 1.9-3.9 3.1-4.2 4.2-6.3 9.2-6.3 15.2v20.6c0 1.9.2 3.7.6 5.4h21.4V89.1 145c.6 3.3 2.2 6.2 4.7 8.7 3.3 3.4 7.3 5 12 5s8.9-1.8 12.7-5.3c2.8-2.6 4.5-5.5 5-8.7v-15.9H47h26-13v15.9c.5 3.2 2.2 6.1 5 8.7 3.8 3.5 8 5.3 12.7 5.3 4.7 0 8.7-1.7 12-5 2.5-2.5 4-5.4 4.7-8.7V89v22.6h21.4c.4-1.7.6-3.5.6-5.4V85.6c0-5.8-2.1-10.9-6.3-15.1M60 118.1V88v30.1z"
        />
        <path
          fill="#2D2D2D"
          d="M59.7 2.5c-1.1 0-2 .4-2.7 1.1-.7.7-1.1 1.6-1.1 2.7s.4 2 1.1 2.7c.7.7 1.6 1.1 2.7 1.1s2-.4 2.7-1.1c.7-.7 1.1-1.6 1.1-2.7s-.4-2-1.1-2.7c-.7-.8-1.6-1.1-2.7-1.1z"
        />
        <path
          fill="none"
          stroke="#2D2D2D"
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="4"
          d="M115.8 111.6c.4-1.7.6-3.5.6-5.4V85.6c0-5.9-2.1-11-6.3-15.2-1.2-1.2-2.5-2.3-3.9-3.1-3.3-2.1-7.1-3.2-11.3-3.2h0c-.7 0-1.5 0-2.2.1h-.4m-.2.1c-1.7 4.3-4.3 8.3-7.9 11.8-6.7 6.7-14.9 10.1-24.4 10.1-3.9 0-7.6-.6-11-1.7-.8-.3-1.7-.6-2.5-.9-.1 0-.2-.1-.2-.1-3.9-1.7-7.5-4.2-10.7-7.4-3-3-5.4-6.3-7.1-9.9-.3-.6-.5-1.2-.8-1.8-.8-.1-1.7-.1-2.6-.1h0c-4.2 0-8 1.1-11.3 3.2-1.4.9-2.7 1.9-3.9 3.1-4.2 4.2-6.3 9.2-6.3 15.2v20.6c0 1.9.2 3.7.6 5.4h21.4V89.2m80.9-21.8V53.8c0-6.3-2.2-11.7-6.7-16.2-3-3-6.5-5.1-10.4-6m-.3.8c3.9 5.6 5.8 12 5.8 19.2 0 4.2-.7 8.1-2 11.8m-33-53.3c-1.1 0-2-.4-2.7-1.1-.7-.7-1.1-1.6-1.1-2.7s.4-2 1.1-2.7c.7-.7 1.6-1.1 2.7-1.1s2 .4 2.7 1.1c.7.7 1.1 1.6 1.1 2.7s-.4 2-1.1 2.7c-.7.7-1.6 1.1-2.7 1.1v7.1h.1c9.5 0 17.7 3.4 24.4 10.1 1.4 1.4 2.6 2.8 3.7 4.3 0 0 0 .1.1.1 0 .1.1.1.1.2l.1.1s0 0 0 0l.1.1s0 0 0 0 0 0 0 0l.1.1h0l.1.1.2.2c3.8 5.6 5.7 12 5.7 19.1 0 4.2-.6 8.1-1.9 11.7l-.3.9m-3-32.6h0c-.1 0-.1 0 0 0-.1 0-.1 0 0 0-.3-.1-.6-.1-.8-.2h-.2s0 .1.1.1v.1c.1.1.2.3.3.4 0 0 0 0 0 0h0c.1.1.2.3.3.4 0 0 0 0 0 0m-57.1-1c1.1-1.4 2.3-2.8 3.6-4.2 6.7-6.7 14.8-10.1 24.3-10.1m-46 50.3V53.8c0-6.3 2.2-11.7 6.7-16.2 3.3-3.3 7.1-5.4 11.4-6.2-4.3 5.9-6.5 12.6-6.5 20.3 0 4.6.8 8.8 2.3 12.7m65.1-.9s0 0 0 0h0v.2l-.2.5c0 .1-.1.1-.1.2m2.3 63.3h.3c5.9 0 11-2.1 15.2-6.3 2.9-2.9 4.7-6.1 5.6-9.8H94.4v16.1h.2m0 0h0m-47.3 1.1H73m-13 16c.5 3.2 2.2 6.1 5 8.7 3.8 3.5 8 5.3 12.7 5.3 4.7 0 8.7-1.7 12-5 2.5-2.5 4-5.4 4.7-8.7v-17.3m-68.8-.1V145c.6 3.3 2.2 6.2 4.7 8.7 3.3 3.4 7.3 5 12 5s8.9-1.8 12.7-5.3c2.8-2.6 4.5-5.5 5-8.7v-15.9m-34.4-1.1s0 0 0 0h-.3s0 0 0 0H25c-5.9 0-11-2.1-15.2-6.3-2.9-2.9-4.7-6.1-5.6-9.8m21.4 0v16.1m68.8-38.6v22.6M60 118.1V88"
        />
        <path
          fill="#7592A0"
          d="M84.5 68.6c6.8-4.3 10.2-9.5 10.2-15.5 0-5.1-2.4-9.6-7.2-13.4H32c-4.8 3.8-7.3 8.3-7.3 13.4 0 6.1 3.4 11.2 10.2 15.5C41.7 72.9 50 75 59.6 75c9.8 0 18-2.1 24.9-6.4z"
        />
        <path
          fill="none"
          stroke="#2D2D2D"
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="4"
          d="M94.7 53.1c0 6.1-3.4 11.2-10.2 15.5-6.8 4.3-15.1 6.4-24.7 6.4-9.7 0-17.9-2.1-24.7-6.4-6.8-4.3-10.2-9.5-10.2-15.5 0-5.1 2.4-9.6 7.3-13.4h55.5c4.6 3.8 7 8.3 7 13.4z"
        />
        <path
          fill="none"
          stroke="#E6E6E6"
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="4"
          d="M83.5 47.6c2.4 3.5 2.4 7.8 0 12.7M35.8 47.6c-2.4 3.5-2.4 7.8 0 12.7"
        />
        <path
          fill="#1668B2"
          stroke="#EF3D43"
          stroke-miterlimit="10"
          stroke-width="1.439"
          d="M70.9 95.9c0-4.807 3.893-8.7 8.7-8.7 4.807 0 8.7 3.893 8.7 8.7 0 4.807-3.893 8.7-8.7 8.7a8.698 8.698 0 0 1-8.7-8.7z"
        />
        <path
          fill="#FFF"
          d="M79.6 101.7c-1.7 0-2.8-.9-2.6-1.9.5-2.6.9-5.2 1.4-7.8.2-1 .4-2.8 1.2-2.8.8 0 1 1.8 1.2 2.8.5 2.6.9 5.2 1.4 7.8.3 1-.9 1.8-2.6 1.9z"
        />
        <path
          fill="#FFF"
          d="M76.4 101.2c-.4 0-.8-.3-.8-.8v-3.3c0-.4.3-.8.8-.8.4 0 .8.3.8.8v3.3c0 .5-.3.8-.8.8zm6.4 0c-.4 0-.7-.3-.7-.7v-3.3c0-.4.3-.7.7-.7.4 0 .7.3.7.7v3.3c.1.4-.3.7-.7.7z"
        />
        <g fill="#FFF">
          <path d="M73.3 95.3a.7.7 0 1 1 1.4 0 .7.7 0 0 1-1.4 0z" />
          <path
            d="M73.9 95.3c0-.663.045-1.2.1-1.2.055 0 .1.537.1 1.2 0 .663-.045 1.2-.1 1.2-.055 0-.1-.537-.1-1.2z"
          />
          <path
            d="M72.7 95.3c0-.055.582-.1 1.3-.1.718 0 1.3.045 1.3.1 0 .055-.582.1-1.3.1-.718 0-1.3-.045-1.3-.1z"
          />
        </g>
        <g fill="#FFF">
          <path d="M84.1 93.4a.7.7 0 1 1 1.4 0 .7.7 0 0 1-1.4 0z" />
          <path
            d="M84.7 93.4c0-.663.045-1.2.1-1.2.055 0 .1.537.1 1.2 0 .663-.045 1.2-.1 1.2-.055 0-.1-.537-.1-1.2z"
          />
          <path
            d="M83.5 93.4c0-.055.582-.1 1.3-.1.718 0 1.3.045 1.3.1 0 .055-.582.1-1.3.1-.718 0-1.3-.045-1.3-.1z"
          />
        </g>
      </g>
    </svg>
    <div class="box green">drag me</div>

    <div class="box purple">flick me</div>

    <div class="box orange">spin me</div>
    <section class="boxes">
      <div
        ref="purple"
        class="item purple"
        data-color="#9d95ff"
        data-class="purple"
      ></div>
      <div
        ref="green"
        class="item green"
        data-color="#0ae448"
        data-class="green"
      ></div>
    </section>

    <div class="interface">
      <button
        class="button"
        :class="{ playing: paused }"
        @click="togglePlayback"
      >
        <svg
          aria-hidden="true"
          class="button__svg"
          fill="#fff"
          xmlns="http://www.w3.org/2000/svg"
          id="Layer_1"
          data-name="Layer 1"
          viewBox="0 0 24 24"
        >
          <g class="pause">
            <path d="M10,17a1,1,0,0,1-1-1V8a1,1,0,0,1,2,0v8A1,1,0,0,1,10,17Z" />
            <path d="M14,17a1,1,0,0,1-1-1V8a1,1,0,0,1,2,0v8A1,1,0,0,1,14,17Z" />
          </g>
          <path
            class="play"
            d="M16.57,11.32,10.31,7.15a.8.8,0,0,0-1.25.68v8.34a.81.81,0,0,0,1.25.68l6.26-4.17A.81.81,0,0,0,16.57,11.32Z"
          />
        </svg>
        <span class="button__text">pause</span>
      </button>

      <div class="timeline" ref="timeline">
        <div
          class="timeline__item"
          v-for="(item, index) in timelineItems"
          :style="item.style"
          :class="item.class"
          :key="item.class"
        >
          <span></span>
        </div>
      </div>
      <div class="times">
        <div
          v-for="(ms, index) in roundedMilliseconds"
          :class="{ label: index === labelPosition * 10 }"
          :key="index"
        >
          <span>{{ index / 10 }}</span>
        </div>
      </div>
      <div class="scrubber" ref="scrubber"></div>
    </div>

    <div class="code-container">
      <span class="code"
        >tl.to(".green-box", { x: {{ endX }}, duration: 1 }<span
          :class="{ 'hide-comma': hidePosition }"
          >,&nbsp;</span
        ></span
      >
      <span
        class="code position-text"
        :class="hidePosition ? 'hide-position' : ''"
        >{{ formattedPosition }}</span
      >
      <span class="code">);</span>
    </div>

    <div class="code-container mobile">
      <div>tl.to(".green-box", {</div>
      <div>&nbsp;&nbsp;x: {{ endX }},</div>
      <div>&nbsp;&nbsp;duration: 1</div>
      <div>
        }<span :class="hidePosition ? 'hide-comma' : ''">,&nbsp;</span
        ><span
          class="position-text"
          :class="{ 'hide-position': hidePosition }"
          >{{ formattedPosition }}</span
        >);
      </div>
    </div>

    <div class="options">
      <div class="options__container flow reference">
        <h3>Reference Point</h3>

        <label class="radio radio--simple">
          <input
            :class="{ checked: 'timelineStart' === referencePoint }"
            type="radio"
            value="timelineStart"
            v-model="referencePoint"
          /><span class="box"></span><span class="info">Start of timeline</span>
        </label>

        <label class="radio radio--simple">
          <input
            :class="{ checked: 'timelineEnd' === referencePoint }"
            type="radio"
            value="timelineEnd"
            v-model="referencePoint"
          /><span class="box"></span><span class="info">End of timeline</span>
        </label>

        <label class="radio">
          <input
            :class="{ checked: 'previousStart' === referencePoint }"
            type="radio"
            value="previousStart"
            v-model="referencePoint"
          /><span class="box">&lt;</span
          ><span class="info"
            >Start of <span class="purpleTxt">previous animation</span></span
          >
        </label>

        <label class="radio">
          <input
            :class="{ checked: 'previousEnd' === referencePoint }"
            type="radio"
            value="previousEnd"
            v-model="referencePoint"
          />
          <span class="box">&gt;</span
          ><span class="info"
            >End of <span class="purpleTxt">previous animation</span></span
          >
        </label>

        <label class="radio">
          <input
            v-bind:class="{ checked: 'label' === referencePoint }"
            type="radio"
            value="label"
            v-model="referencePoint"
          />
          <span class="box box--label">myLabel</span
          ><span class="info">Label</span>
        </label>
      </div>

      <div class="options__container offsets">
        <h3>Offset</h3>

        <div
          class="offset"
          :class="{ 'offset--previous': useRecent && usePrevious }"
        >
          <input
            class="number"
            @wheel=""
            v-model="offsetNumber"
            type="number"
            :min="-range"
            :max="range"
            :step="offsetType === 'percent' ? 5 : 0.5"
          />
          <label
            class="offset__type"
            :class="{ checked: 'seconds' === offsetType }"
          >
            <input type="radio" value="seconds" v-model="offsetType" /> Seconds
          </label>
          <label
            v-if="referencePoint !== 'timelineStart'"
            class="offset__type"
            :class="{ checked: 'percent' === offsetType }"
          >
            <input
              type="radio"
              value="percent"
              v-model="offsetType"
              :disabled="referencePoint === 'timelineStart'"
            />
            Percent
          </label>
        </div>
        <div v-if="usePrevious">
          <label class="radio radio--simple">
            <input
              type="checkbox"
              :class="{ checked: useRecent }"
              v-model="useRecent"
            /><span class="box"></span
            ><span class="info"
              >Use percentage of
              <span class="purpleTxt"> previous animation</span></span
            >
          </label>
        </div>
      </div>
    </div>
  </div>
  
</template>

<script>
// https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.4/Draggable.min.js
// https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.4/EaselPlugin.min.js
// https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.4/Flip.min.js
// https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.4/MotionPathPlugin.min.js
// https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.4/Observer.min.js
// https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.4/PixiPlugin.min.js
// https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.4/ScrollTrigger.min.js
// https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.4/ScrollToPlugin.min.js
// https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.4/TextPlugin.min.js
// https://s3-us-west-2.amazonaws.com/s.cdpn.io/16327/DrawSVGPlugin3.min.js
// https://s3-us-west-2.amazonaws.com/s.cdpn.io/16327/Physics2DPlugin3.min.js
// https://s3-us-west-2.amazonaws.com/s.cdpn.io/16327/PhysicsPropsPlugin3.min.js
// https://s3-us-west-2.amazonaws.com/s.cdpn.io/16327/MorphSVGPlugin3.min.js
import { gsap } from "gsap-trial";

import { CustomEase } from "gsap-trial/CustomEase";
import { RoughEase, ExpoScaleEase, SlowMo } from "gsap-trial/EasePack";

/* The following eases are Club GSAP perks */
import { CustomBounce } from "gsap-trial/CustomBounce"; // extends CustomEase
import { CustomWiggle } from "gsap-trial/CustomWiggle"; // extends CustomEase

import { Flip } from "gsap-trial/Flip";
import { Observer } from "gsap-trial/Observer";
import { ScrollToPlugin } from "gsap-trial/ScrollToPlugin";
import { Draggable } from "gsap-trial/Draggable";
import { MotionPathPlugin } from "gsap-trial/MotionPathPlugin";
import { EaselPlugin } from "gsap-trial/EaselPlugin";
import { PixiPlugin } from "gsap-trial/PixiPlugin";
import { TextPlugin } from "gsap-trial/TextPlugin";

/* The following plugins are Club GSAP perks */
import { DrawSVGPlugin } from "gsap-trial/DrawSVGPlugin"; // extends MotionPathPlugin
import { ScrollSmoother } from "gsap-trial/ScrollSmoother";
import { GSDevTools } from "gsap-trial/GSDevTools";
import { InertiaPlugin } from "gsap-trial/InertiaPlugin";
import { MotionPathHelper } from "gsap-trial/MotionPathHelper";
import { Physics2DPlugin } from "gsap-trial/Physics2DPlugin";
import { PhysicsPropsPlugin } from "gsap-trial/PhysicsPropsPlugin";
import { ScrambleTextPlugin } from "gsap-trial/ScrambleTextPlugin";
import { SplitText } from "gsap-trial/SplitText";

gsap.registerPlugin(
  Flip,
  Observer,
  ScrollToPlugin,
  Draggable,
  MotionPathPlugin,
  EaselPlugin,
  PixiPlugin,
  TextPlugin,
  DrawSVGPlugin,
  ScrollSmoother,
  GSDevTools,
  InertiaPlugin,
  MotionPathHelper,
  Physics2DPlugin,
  PhysicsPropsPlugin,
  ScrambleTextPlugin,
  SplitText,
  RoughEase,
  ExpoScaleEase,
  SlowMo,
  CustomEase,
  CustomBounce,
  CustomWiggle
);
export default {
  name: "Gsap",
  components: {},
  data() {
    return {
      labelPosition: 1,
      paused: false,
      roundedMilliseconds: 0,
      percentRange: 200,
      secondsRange: 5,
      useRecent: false,
      referencePoint: "timelineStart",
      offsetType: "seconds",
      offsetNumber: 1,
      position: 0,
      hidePosition: false,
      lastSecond: 1,
      lastPercent: 50,
      endX: 500,
      timelineItems: [],
      timelineData: [{ class: "purple" }, { class: "green" }],
    };
  },
  mounted() {
    Draggable.create(".green", { bounds: "body" });
    Draggable.create(".purple", { inertia: true, bounds: "body" });
    Draggable.create(".orange", {
      inertia: true,
      type: "rotation",
      bounds: "body",
    });

    gsap.set(".astronaut", { scale: 0.5, autoAlpha: 1 });
    gsap.to(".astronaut", {
      duration: 5,
      ease: "power1.inOut",
      immediateRender: true,
      motionPath: {
        path: "#path",
        align: "#path",
        alignOrigin: [0.5, 0.5],
        autoRotate: 90,
      },
    });
    MotionPathHelper.create(".astronaut");

    this.setScrubber = gsap.quickSetter(this.$refs.scrubber, "x", "px");
    this.clampSeconds = gsap.utils.clamp(-this.secondsRange, this.secondsRange);
    this.clampPercent = gsap.utils.clamp(-this.percentRange, this.percentRange);
    this.mapSize = gsap.utils.mapRange(30, 90, 1.1, 0.65);

    this.timeline = gsap.timeline();

    this.createScrubber();
    this.renderTimeline();

    window.addEventListener("resize", this.onResize);

    this.$nextTick(() => {
      this.onResize();
      this.timeline.eventCallback("onUpdate", this.updateScrubber);

      // get browser to repaint scaling
      gsap.set(".position-text", { rotation: 0.001, force3D: false });
      gsap.to("#app", { opacity: 1 });
    });
  },
  computed: {
    formattedPosition() {
      if (this.hidePosition) {
        return "";
      }
      if (this.referencePoint !== "timelineStart") {
        return `"${this.position}"`;
      }
      return this.position;
    },
    range() {
      return this.offsetType === "percent"
        ? this.percentRange
        : this.secondsRange;
    },
    usePrevious() {
      return (
        this.referencePoint.includes("previous") &&
        this.offsetType === "percent"
      );
    },
  },
  watch: {
    formattedPosition: "animatePosition",
    useRecent: "renderTimeline",
    referencePoint(value) {
      if (value === "timelineStart") {
        this.offsetType = "seconds";
      }

      this.renderTimeline();
    },
    offsetNumber(value) {
      value = parseFloat(value);
      if (isNaN(value)) return;

      if (this.offsetType === "percent") {
        this.offsetNumber = this.clampPercent(value);
      } else {
        this.offsetNumber = this.clampSeconds(value);
      }

      this.renderTimeline();
    },
    offsetType(value) {
      if (value === "percent") {
        this.lastSecond = this.offsetNumber;
        this.offsetNumber = this.lastPercent;
      } else {
        this.lastPercent = this.offsetNumber;
        this.offsetNumber = this.lastSecond;
      }

      this.renderTimeline();
    },
  },
  methods: {
    renderTimeline() {
      this.position = this.getPosition();
      this.endX = this.scrubber.maxX - 56;

      let tl = this.timeline;

      tl.progress(0)
        .clear(true)
        .addLabel("myLabel", this.labelPosition)
        .to(
          this.$refs.purple,
          {
            ease: "none",
            duration: 2,
            x: this.endX,
            data: this.timelineData[0],
          },
          0
        )
        .to(
          this.$refs.green,
          {
            ease: "none",
            duration: 1,
            x: this.endX,
            data: this.timelineData[1],
          },
          this.position
        );

      let timelineItems = [];
      let time = tl.duration();
      let children = tl.getChildren();
      let milliseconds = time * 10;
      this.roundedMilliseconds = Math.floor(milliseconds) + 1;

      let fontSize = this.mapSize(this.roundedMilliseconds);
      document.documentElement.style.setProperty(
        "--number-size",
        fontSize + "rem"
      );

      children.forEach((child, index) => {
        let duration = child.totalDuration();
        let startTime = child.startTime();
        let width = (duration / time) * 100;
        let startPosition = (startTime / time) * 100;

        timelineItems[index] = {
          ...child.data,
          style: {
            width: `${width}%`,
            marginLeft: `${startPosition}%`,
          },
        };
      });

      // trigger render
      this.timelineItems = timelineItems;
    },
    getPosition() {
      this.hidePosition = false;
      let value = parseFloat(this.offsetNumber);

      let isNegative = value < 0;
      let isPercent = this.offsetType === "percent";

      if (this.referencePoint !== "timelineStart") {
        value = Math.abs(value);
      }

      let isZero = value === 0;
      let offset = isPercent ? `${value}%` : value;

      switch (this.referencePoint) {
        case "timelineStart":
          return value;

        case "timelineEnd":
          if (isZero) {
            this.hidePosition = true;
            return "";
          }
          return (isNegative ? "-=" : "+=") + offset;

        case "previousStart":
          if (isZero) {
            return "<";
          }
          if (isPercent && !this.useRecent) {
            return (isNegative ? "<-=" : "<+=") + offset;
          }
          return (isNegative ? "<-" : "<") + offset;

        case "previousEnd":
          if (isZero) {
            return ">";
          }
          if (isPercent && !this.useRecent) {
            return (isNegative ? ">-=" : ">+=") + offset;
          }
          return (isNegative ? ">-" : ">") + offset;

        case "label":
          if (isZero) return "myLabel";
          return "myLabel" + (isNegative ? "-=" : "+=") + offset;

        default:
          return 0;
      }
    },
    createScrubber() {
      this.scrubber = new Draggable(this.$refs.scrubber, {
        type: "x",
        cursor: "pointer",
        bounds: this.$refs.timeline,
        zIndexBoost: false,
        onPress: () => {
          this.timeline.pause();
          this.paused = true;
        },
        onDrag: () => {
          let progress = this.normalize(this.scrubber.x);
          this.timeline.progress(progress);
        },
      });
    },
    togglePlayback() {
      if (this.timeline.progress() > 0.98) {
        this.paused = false;
        return this.timeline.restart();
      }
      this.paused = !this.paused;
      this.timeline.paused(this.paused);
    },
    onResize() {
      this.scrubber.update(true);
      this.normalize = gsap.utils.normalize(
        this.scrubber.minX,
        this.scrubber.maxX
      );
      this.interpolate = gsap.utils.interpolate(
        this.scrubber.minX,
        this.scrubber.maxX
      );
      this.updateScrubber();
      this.renderTimeline();
    },
    updateScrubber() {
      let x = this.interpolate(this.timeline.progress());
      this.setScrubber(x);
    },
    animatePosition() {
      gsap.fromTo(
        ".position-text",
        {
          scale: 1,
          yPercent: -5,
        },
        {
          overwrite: true,
          duration: 0.6,
          scale: 1.05,
          yPercent: -10,
          ease: "wiggle",
        }
      );
    },
  },
};
</script>

<style lang="scss" scoped>
@import url("https://fonts.googleapis.com/css2?family=Signika+Negative:wght@400;600&display=swap");

.box {
  display: block;
  display: flex;
  width: 100px;
  height: 100px;
  align-items: center;
  justify-content: center;
  padding: 0.5rem;
}

$mobile: 800px;

:root {
  --number-size: 1.2rem;
}

.item {
  width: 45px;
  height: 45px;
  border-radius: 10px;
  margin-top: 0.5rem;
}

.green {
  background-color: #0ae448;
}

.purple {
  background-color: #9d95ff;
}
.orange {
  background-color: #ff8c00;
}
body {
  padding: 0.5rem;
  font-family: "Signika Negative", sans-serif, Arial;
  background: #1d1d1d;
  color: #fffce1;
  min-height: 100vh;
  box-sizing: border-box;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  font-size: 16px;
  letter-spacing: 1px;
  margin: 0;
}

h3 {
  font-size: 21px;
  margin-bottom: 0.5rem;
  color: #fffce1;
  font-weight: 400;
}

#app {
  opacity: 0;
}

.flow > * + * {
  margin-top: 0.5rem;
}

.interface {
  // opacity:0;
  position: relative;
  padding: 2.2rem 2rem 2.2rem;
  background-color: #262626;
  border-radius: 10px;
  width: clamp(300px, 80vw, 900px);
  box-shadow: 0 19px 28px rgba(0, 0, 0, 0.05), 0 15px 8px rgba(0, 0, 0, 0.04);

  &__title {
    position: relative;
    color: #fffce1;
    display: block;
    width: 100%;
    padding-bottom: 1rem;
    padding-left: 3px;
    display: flex;
    flex-direction: row;
    h1 {
      font-size: 1.2rem;
    }
  }
}

.timeline > * + * {
  margin-top: 0.5rem;
}

.timeline__item {
  width: 2px;
  margin: 0.5rem;
  border-radius: 999px;
  box-sizing: border-box;
  text-align: center;
  height: 18px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.timeline__item.purple span {
  display: none;
  font-size: 0.85rem;
}

.scrubber {
  position: absolute;
  bottom: 2rem;
  left: 0;
  width: 20px;
  height: 20px;
  border-radius: 99px;
  background-color: #fffce1;
  z-index: 1;
}

.button__svg {
  width: 2rem;
  height: 2rem;
  margin-top: 0px;
  pointer-events: none;
}

.button {
  position: absolute;
  font-size: 0;
  border: none;
  outline: none;
  background-color: transparent;
  top: 10px;
  left: 1rem;
  cursor: pointer;
}

.button.playing {
  .pause {
    opacity: 1;
  }
  .play {
    opacity: 0;
  }
}

.button:not(.playing) {
  .pause {
    opacity: 0;
  }
  .play {
    opacity: 1;
  }
}

.times {
  width: calc(100% - 20px);
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  z-index: 999;
  margin-left: 10px;
}

.times > * {
  position: relative;
}

.times div {
  margin-top: 1rem;
  width: 0.5px;
  height: 5px;
  background-color: #fffce1;
  opacity: 0.7;
  position: relative;
}

.times span {
  display: none;
  font-size: var(--number-size);
}

.times div:nth-child(5n + 1) {
  height: 10px;
  background-color: #fffce1;
  opacity: 1;
}

.times div:nth-child(5n + 1) span {
  display: block;
  color: #fffce1;
  text-align: center;
  position: absolute;
  width: auto;
  height: 1rem;
  top: 1rem;
  left: 50%;
  transform: translateX(-50%);
  z-index: 2;
}

.times .label {
  height: 10px;
  background-color: #00000090;
}

.times .label span {
  position: absolute;
  width: 1rem;
  height: 1rem;
  top: 1rem;
  left: 0%;
  transform: translateX(-0.5rem);
  z-index: 2;
}

.times .label:after {
  font-size: 0.85rem;
  text-align: center;
  position: absolute;
  background-size: 70%;
  background-position: center bottom;
  background-repeat: no-repeat;
  width: 60px;
  height: 30px;
  left: -30px;
  top: 400%;
  z-index: 9;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' id='Capa_1' x='0' y='0' version='1.1' viewBox='0 0 344.406 344.406' xml:space='preserve'%3E%3Cpath fill='%232191FB' d='M243.243 0h-142.08c-13.767.044-24.916 11.193-24.96 24.96v298.8c0 21 21.04 31.2 37.48 5l58.52-93.28 58.52 93.28c16.44 26.2 37.48 15.96 37.48-5V24.96C268.159 11.193 257.01.044 243.243 0z'/%3E%3C/svg%3E");
}

.boxes {
  display: flex;
  margin-bottom: 0.5rem;
  z-index: -1;
  pointer-events: none;
  flex-direction: column;
}

.emoji {
  margin: 1rem;
  width: 2rem;
  height: 2rem;
}

.heart {
  width: 3rem;
  height: 2.5rem;
  object-position: 85%;
}

#options {
  margin-top: 2.5rem;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;

  .input {
    margin-top: 2rem;
    font-size: 1.3rem;
    border: none;
    outline: none;
    padding: 1rem 0.5rem;
    border-bottom: solid 4px #51da85;
  }
}

.radios {
  display: flex;
}

.radio {
  display: flex;
  align-items: center;
}

.radio .box {
  width: 50px;
  background-color: #464646;
  border-radius: 5px;
  cursor: pointer;
  padding: 0.5rem;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.8rem;
}

.radio .info {
  display: inline-block;
  margin-left: 1rem;
}

.radio:nth-of-type(5) .checked ~ .box {
  border-color: #2191fb;
  background-color: #2191fb;
  color: #fff;
}

.checked ~ .box {
  border-color: #9d95ff;
  background-color: #9d95ff;
  color: #fffce1;
}

.radio input {
  position: absolute;
  opacity: 0;
}

.radio--simple .box {
  position: relative;
  width: 15px;
  height: 15px;
  padding: 0;
  border-radius: 99%;
  border-color: #ddd;
}

.radio--simple .box:after {
  position: absolute;
  content: "";
  width: 75%;
  height: 75%;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  border-radius: 99%;
  opacity: 0;
  background-color: #464646;
}

.radio--simple .checked ~ .box {
  border-color: #51da85;
  background-color: #51da85;
}
.radio--simple .checked ~ .box:after {
  opacity: 1;
}

.offset {
  background-color: #464646;
  border-radius: 5px;
  cursor: pointer;
  display: flex;
  font-size: 1rem;
  display: inline-flex;
  overflow: hidden;

  input:not(.number) {
    opacity: 0;
    position: absolute;
  }

  .offset__type {
    flex-grow: 1;
    display: flex;
    align-items: center;
    padding: 0.25rem;
    font-size: 0.8rem;
  }

  .offset__type.checked {
    background-color: #0ae448;
    color: #1b1b1b;
  }
}

.offsets .radio--simple {
  margin-top: 1rem;
}

.offsets .radio--simple .checked ~ .box {
  background-color: #9d95ff;
}

.offset--previous {
  .offset__type.checked {
    background-color: #9d95ff;
  }
}

.offset--previous {
  border-color: #9d95ff;
}

.text {
  width: 100%;
}
.label {
  display: block;
  margin-top: 1rem;
}

.number {
  border: none;
  padding: 0.5rem 1rem;
  padding-right: 0.2rem;
  font-size: 1rem;
  border-radius: 20px;
  outline: none;
  background-color: #464646;
  color: #fff;
}

.helperText {
  opacity: 0;
  min-height: 135px;
  text-align: center;
}

.greenTxt {
  color: #25b961;
  font-weight: bold;
}
.purpleTxt {
  color: #9d95ff;
  font-weight: bold;
}
.blueTxt {
  color: #2191fb;
  font-weight: bold;
}

.invalid {
  height: 2rem;
  font-size: 0.85rem;
}

footer {
  display: flex;
}

.code {
  opacity: 0.6;
}

.position-text {
  font-size: 1.4rem;
  opacity: 1;
  margin: 0.1em;
  margin-bottom: 0.2em;
  padding: 5px 2px;
  padding-bottom: 0;
  font-weight: 600;
}

.code-container {
  font-family: "Fira Code", monospace;
  margin-top: 2rem;
  font-size: 0.9rem;
  padding: 0.51rem;
  align-items: center;
  line-height: 2em;
  color: #fff;
}

.code-container:not(.mobile) {
  display: flex;
  justify-content: center;
  white-space: pre;
}

.code-container.mobile {
  display: none;
}

.code-container.mobile .position-text {
  display: inline-block;
}

.code {
  white-space: pre;
}

.options {
  display: flex;
  flex-wrap: wrap;
  flex: 1 1 auto;
}

.options__container {
  flex: 0 0 50%;
  max-width: 50%;
}

.hide-comma {
  display: none;
}

.code-container .position-text.hide-position {
  margin-left: 0;
  display: none;
}

@media (max-width: $mobile) {
  .options__container {
    flex: 0 0 100%;
    max-width: 100%;
  }

  .code-container:not(.mobile) {
    display: none;
  }

  .code-container.mobile {
    display: block;
  }

  .position-text {
    font-size: 1.3rem;
  }
}

#motionPath {
  overflow: visible;
  height: 100%;
  max-width: 100%;
}

#motionPath path {
  stroke-width: 2;
  stroke: gray;
}

#motionPath .astronaut {
  visibility: hidden;
}
</style>
